# DeskPet Live2D - 智能桌面宠物助手

> 一个集成了 Live2D 动画角色、专注时间追踪、番茄钟、AI 聊天和实用工具的桌面宠物应用

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)
[![PySide6](https://img.shields.io/badge/PySide6-6.5%2B-green)](https://pypi.org/project/PySide6/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

---

## ✨ 功能特性

### 🎯 核心功能
- **Live2D 动画角色** - 桌面端实时渲染的可爱角色（支持占位动画）
- **专注时间追踪** - 自动检测用户活动状态，记录每日专注时长
- **智能状态检测** - 活跃/空闲/睡眠三种状态，实时反馈
- **交互式反馈** - 根据用户行为触发宠物对话和动作

### 🔥 已实现亮点功能
- ✅ **每日登录奖励** - 连续登录天数追踪，根据天数给予好感度奖励（2/5/10/20点）
- ✅ **数据备份与恢复** - 一键备份/恢复所有数据（settings/stats/pomodoro/clipboard/note/launchers）
- ✅ **快速工具栏** - 悬浮4按钮工具栏（显示/隐藏、便签、番茄钟、设置），2.5秒自动隐藏
- ✅ **增强被动对话** - 30+条随机鼓励消息，情境感知（IDE/浏览器/设计软件/睡眠状态）
- ✅ **番茄钟进度条** - 实时显示专注/休息进度，完成获得好感度奖励
- ✅ **AI 对话历史** - 自动保存最近6轮对话上下文，提供更连贯的对话体验
- ✅ **交互式反馈** - 打字时随机鼓励，空闲时提醒休息，切换窗口时建议专注
- ✅ **键盘快捷键** - 全局热键快速操作（Ctrl+Shift+L: 显示/隐藏, Ctrl+Shift+P: 便签, Ctrl+Shift+T: 番茄钟）
- ✅ **心情/状态系统** - 基于互动/专注/好感度/空闲计算心情，影响对话语气与被动频率
- ✅ **每日/每周总结推送** - 17:00 或达成条件触发专注/番茄钟汇总
- ✅ **热键可视化提示** - 按住 Ctrl+Shift 显示快捷键浮窗提示
- ✅ **托盘重启** - 一键重启应用
- ✅ **动作绑定系统** - 情绪/状态/番茄钟/AI/互动触发动作与表情
- ✅ **模型切换** - 工具面板一键切换本地模型
- ✅ **快速启动器** - 一键打开网页/应用程序/工作流组合

### 🤖 AI 聊天系统
- **OpenAI 兼容 API** - 支持多种 AI 服务提供商
- **多提供商配置** - 可配置多个 AI 提供商并启用/禁用
- **上下文感知** - 聊天时自动附带今日专注时间作为上下文
- **好感度系统** - 互动影响宠物语气，80+ 亲近，25- 保持礼貌
- **连接测试** - 内置 API 连接测试工具

### 🍅 番茄钟工作法
- **专注/休息循环** - 25分钟专注 + 5分钟休息（可自定义）
- **每日统计** - 记录完成的番茄钟数量
- **实时倒计时** - 显示剩余时间
- **自动通知** - 模式切换时系统托盘提醒
- **专注奖励** - 完成番茄钟获得好感度

### 🧠 智能提醒系统
- **休息提醒** - 长时间专注后提醒休息（默认90分钟）
- **喝水提醒** - 定时提醒补充水分（默认60分钟）
- **护眼提醒** - 定时提醒远眺放松（默认45分钟）
- **待办事项** - 支持设置带时间的任务提醒
- **智能触发** - 仅在活跃状态计时，避免无效提醒

### 💬 被动对话
- **自动问候** - 早安（5-10点）/晚安（20-23点）
- **专注播报** - 定期汇报专注进度（默认60分钟）
- **随机闲聊** - 间隔性发送鼓励消息（默认30分钟）
- **情境感知** - 根据当前窗口智能对话（IDE/浏览器/设计软件）
- **健康提醒** - 健康相关的温馨提示

### 🔧 实用工具
- **便签/备忘录** - 快速记录，自动保存，300ms 防抖
- **剪贴板历史** - 自动记录复制历史（最多30条），支持搜索和恢复
- **系统监控** - CPU、内存、网络、电池实时监控（1秒刷新）
- **全局热键** - Ctrl+Shift+L/P/T 快速操作
- **快速启动器** - 一键打开常用网页/应用/工作流

### 🎨 个性化设置
- **窗口设置** - 透明度、位置、锁定、显示/隐藏
- **模型调整** - 缩放、位置微调、动画速度
- **UI 缩放** - 界面大小调整（0.5-2.0倍）
- **专注阈值** - 自定义活跃/睡眠判定时间
- **热键配置** - 可自定义全局快捷键

---

## 📁 项目结构

```
tools_live2D/
├── backend/                    # Python 后端
│   ├── main.py                # 应用入口，GUI、系统托盘、登录奖励、备份恢复
│   ├── bridge.py              # 后端-前端通信桥（含备份/恢复信号）
│   ├── ai_client.py           # AI API 集成（带6轮对话历史）
│   ├── focus.py               # 专注/空闲检测引擎
│   ├── stats.py               # 专注统计管理
│   ├── settings.py            # 配置管理
│   ├── pomodoro.py            # 番茄钟引擎（带奖励计算）
│   ├── reminders.py           # 提醒系统（休息/喝水/护眼/待办）
│   ├── passive_chat.py        # 被动对话引擎（30+消息，情境感知）
│   ├── clipboard.py           # 剪贴板历史（30条历史+搜索）
│   ├── notes.py               # 便签存储（300ms防抖）
│   ├── sysinfo.py             # 系统信息监控（CPU/内存/网络/电池）
│   ├── login_rewards.py       # 每日登录奖励系统
│   ├── achievements.py        # 每日/每周成就总结
│   ├── mood.py                # 心情计算与分档
│   ├── hotkeys.py             # 全局热键管理
│   ├── model_bindings.py      # 动作绑定管理
│   ├── binding_utils.py       # 模型动作/表情提取工具
│   ├── launchers.py           # 快速启动器管理
│   ├── hotkey_hints.py        # 热键提示文案生成
**?? ???????**
- `login_rewards.py` - ?????????????
- `achievements.py` - ??/????????
- `mood.py` - ???????
- `hotkeys.py` - ??????????Windows API?
- `hotkey_hints.py` - ????????
- `binding_utils.py` - ????/??????
- `launchers.py` - ???????
- `plugins.py` - ???????/??/?????
- `bridge.py` ?? - ??/???????????/??????
---

## 🎮 使用指南

### 系统托盘菜单

右键点击托盘图标访问所有功能：

| 菜单项 | 功能 |
|--------|------|
| **暂停统计** | 暂停专注时间追踪 |
| **查看今日专注时间** | 显示今日专注时长 |
| **个性化设置** | 调整窗口和模型参数（含热键配置） |
| **AI 详细配置** | 配置多个 AI 提供商（5列表格） |
| **数据备份** | 导出所有数据为 ZIP 文件 |
| **数据恢复** | 从 ZIP 文件恢复所有数据 |
| **窗口位置** | 快速定位到屏幕角落（左上/右上/左下/右下/居中） |
| **插件管理** | 打开插件管理界面（启用/禁用/重载/安装/卸载） |
| **隐藏宠物窗口** | 显示/隐藏宠物 |
| **锁定位置** | 禁止拖动宠物窗口 |
| **重启程序** | 重启应用 |
| **关闭程序** | 退出应用 |

**提示：** 备份/恢复会导出 settings.json, stats.json, pomodoro.json, clipboard.json, note.txt

### 前端界面操作

#### 1. 聊天面板（左下角）
- **点击标题** - 展开/收起聊天框
- **移动按钮** - 进入移动模式，可拖动整个窗口
- **设置按钮** - 打开快速设置面板
- **输入框** - 与 AI 对话（需配置 API Key）
- **礼物按钮** - 点击赠送礼物，增加好感度（+5）

**聊天特性：**
- 发送消息自动 +1 好感度
- AI 回复时自动触发相关 Live2D 动作
- 上下文感知：自动附带今日专注时间

#### 2. 右键菜单（宠物窗口）
在宠物窗口任意位置右键，弹出功能菜单：
- **工具** - 打开工具面板（便签/剪贴板/系统信息/快速启动）
- **番茄钟** - 开启番茄钟模式（实时进度条）
- **智能提醒** - 配置健康提醒（休息/喝水/护眼）
- **AI 配置** - 设置 AI 参数（快速/详细两种模式）
- **被动对话** - 配置自动对话（定时/随机/情境）
- **设置** - 个性化调整（透明度/缩放/阈值/热键）
- **隐藏聊天框** - 切换聊天框显示
- **更多状态** - 查看详细系统信息
- **动作绑定** - 打开动作绑定面板
- **插件** - 打开插件管理面板

**快速工具栏（悬浮7按钮）：**
- 鼠标悬停右下角区域自动显示
- [🎯] 显示/隐藏宠物  [📝] 便签  [⏰] 番茄钟  [🎭] 切换模型  [🚀] 启动器  [⚙️] 设置  [◀] 展开/收起
- 2.5秒无操作自动隐藏

#### 3. 工具面板
点击右键菜单的"工具"，可访问：
- **便签/备忘录** - 快速笔记，300ms 自动保存防抖
- **剪贴板历史** - 自动记录最多30条，支持搜索和一键复制
- **系统信息** - CPU/内存/网络/电池，1秒实时刷新
- **清空剪贴板** - 删除所有剪贴板历史
- **切换模型** - 一键切换本地模型
- **动作绑定** - 打开动作绑定面板
- **快速启动** - 一键打开网页/应用/工作流
- **插件管理** - 管理插件（启用/禁用/重载/安装/卸载）

#### 4. 快速启动器面板
- **搜索** - 实时搜索启动项（名称/标签）
- **类型**：
  - **网页** - 打开指定 URL
  - **应用** - 启动本地程序（支持参数）
  - **套件** - 一键启动多个相关应用
- **热键** - 为每个启动项绑定独立热键
- **最近使用** - 显示最近打开的 5 个启动项
- **管理** - 添加/编辑/删除启动项，支持导入/导出

#### 5. 插件管理面板
- **插件列表** - 显示所有插件（名称/版本/状态/路径/错误）
- **启用/禁用** - 勾选启用插件，取消勾选禁用
- **重新加载** - 支持重新加载单个插件或全部插件
- **安装插件** - 从目录安装插件
- **导入/导出** - 支持 ZIP 格式的插件导入导出
- **卸载插件** - 卸载选中的插件
- **测试钩子** - 手动触发插件钩子进行测试

#### 6. 动作绑定面板
- **分类**：心情/状态/番茄钟/AI/互动
- **绑定内容**：每个触发项可设置动作(Motion)与表情(Expression)
- **预览**：单次预览、循环预览、停止
- **预设**：应用预设、保存为预设、导出预设、重置默认

#### 7. 番茄钟面板
- **设置** - 专注时长（默认25分钟），休息时长（默认5分钟）
- **控制** - 开始/暂停/停止计时
- **状态显示** - 当前模式（专注/休息）、剩余时间、今日完成数
- **实时进度条** - 可视化进度显示
- **联动机制** - 完成专注获得好感度奖励，休息时避免进入睡眠

#### 8. 智能提醒面板
- **休息提醒** - 连续专注后提醒休息（默认90分钟）
- **喝水提醒** - 定时提醒补充水分（默认60分钟）
- **护眼提醒** - 定时远眺放松（默认45分钟）
- **待办事项** - 打开待办管理界面
- **智能触发** - 仅在活跃状态计时，避免无效提醒

#### 9. 待办事项
- **添加** - 输入任务标题和截止时间（日期时间选择器）
- **查看** - 显示所有待办列表，带时间标签
- **提醒** - 到达时间系统托盘通知
- **删除** - 点击删除按钮移除任务

#### 9.3 ????
- **??** - ???????????????????
- **??** - ??/???????????????????
- **??** - ?????????data/plugins/<id>/plugin.log?

#### 9.4 ??????
- **????**?`plugins/<plugin_id>/`????? `plugin.json` ?????
- **plugin.json ??**?`id/name/version/description/entry`
- **????**?`Plugin` ?? `create_plugin(context)` ? `PLUGIN` ??
- **?? UI**??? `get_panel(parent)` ? `open_panel(parent)` ?? PySide6 ??/??
- **????**?`on_app_start/on_app_ready/on_settings/on_state/on_tick/on_ai_reply/on_user_message/on_passive_message`
- **AI ???**?`get_ai_context(user_text)` ? `on_ai_context(user_text)` ?????/??
- **?????**?`context.get_data_path()` ???????`context.log()` ???

#### 10. AI 配置面板
- **快速配置** - 提供商名称、Base URL、模型、API Key
- **详细配置** - 多提供商管理（新增/删除/启用/优先级）
- **本地化信息** - 城市、位置（用于 AI 上下文）
- **测试连接** - 验证 API 可用性，显示结果
- **关键提示** - 回复时自动附带今日专注时间作为上下文

#### 11. 被动对话配置
- **总开关** - 启用/禁用所有被动对话
- **随机闲聊** - 30+条鼓励消息，间隔可调（默认30分钟）
- **早晚祝福** - 早安（5-10点），晚安（20-23点）
- **专注播报** - 汇报专注进度（默认60分钟）
- **情境感知**：
  - IDE（VSCode/PyCharm）："代码写得不错..."
  - 浏览器（Chrome/Edge/Firefox）："查资料吗？需要我帮忙吗？"
  - 设计工具（Photoshop/Figma）："设计得真棒..."
  - 睡眠状态："我有点困了，你也休息一下吧？"

#### 12. 个性化设置（快速设置）
- **活力阈值** - 判定活跃的空闲秒数（默认60秒）
- **睡眠阈值** - 判定睡眠的空闲秒数（默认120秒）
- **透明度** - 窗口透明度（0-100%）
- **模型缩放** - Live2D 模型大小（0.1-2.0）
- **界面缩放** - UI 元素大小（0.5-2.0）
- **动画速度** - 角色动画速度（0.1-2.0）
- **快捷键配置**:
  - 显示/隐藏宠物（默认 Ctrl+Shift+L）
  - 快速便签（默认 Ctrl+Shift+P）
  - 番茄钟开关（默认 Ctrl+Shift+T）
  - 快速启动面板（默认 Ctrl+Shift+Space）

#### 13. 数据备份与恢复
- **备份** - 右键托盘 → 数据备份，导出 ZIP（自动命名带日期）
- **恢复** - 右键托盘 → 数据恢复，选择 ZIP 文件
- **自动重启** - 恢复完成后自动重启应用生效
- **包含文件**:
  - settings.json - 所有配置
  - stats.json - 专注统计数据
  - pomodoro.json - 番茄钟统计
  - clipboard.json - 剪贴板历史
  - note.txt - 便签内容
- **注意**：launchers.json（快速启动器配置）**不包含**在自动备份中，需要手动导出/导入

#### 14. 每日登录奖励
- **首次启动** - 检测连续登录天数
- **奖励计算**:
  - 1天: +2 好感度
  - 3天+: +5 好感度
  - 7天+: +10 好感度
  - 30天+: +20 好感度
- **提示显示** - 气泡显示欢迎词和奖励信息
- **连续性检测** - 断签重置为1天

---

## 🔧 高级配置

### AI 提供商配置

#### 方法1：快速配置（前端）
1. 右键宠物 → AI 配置
2. 填写 Base URL、模型、API Key
3. 点击保存

#### 方法2：详细配置（多提供商）
1. 右键托盘图标 → AI 详细配置
2. 点击"新增"添加多个提供商
3. 勾选"启用"决定使用哪个
4. 支持优先级（第一个为默认）

#### 支持的 API 格式
```json
{
  "name": "OpenAI兼容",
  "base_url": "https://api.openai.com/v1",
  "model": "gpt-4o-mini",
  "api_key": "sk-...",
  "enabled": true
}
```

#### 常用提供商示例
| 服务商 | Base URL | 模型 |
|--------|----------|------|
| OpenAI | `https://api.openai.com/v1` | `gpt-4o-mini` |
| Azure OpenAI | `https://your-resource.openai.azure.com/openai/deployments/gpt-4o` | `gpt-4o` |
| 自建 API | `https://your-api.com/v1` | 自定义 |

### 环境变量配置

你也可以通过环境变量设置默认 AI 配置：

```bash
# Windows (CMD)
set OPENAI_API_KEY=sk-...
set OPENAI_BASE_URL=https://api.openai.com/v1
set OPENAI_MODEL=gpt-4o-mini

# Windows (PowerShell)
$env:OPENAI_API_KEY="sk-..."
$env:OPENAI_BASE_URL="https://api.openai.com/v1"
$env:OPENAI_MODEL="gpt-4o-mini"
```

### Live2D 模型配置

#### 默认模型
应用内置了 **Miku** 示例模型，位于：
- 源文件：`miku/miku/`
- 运行时：`web/model/miku/`

#### 使用自定义模型
1. 将 Live2D Cubism 5 导出的文件放入 `web/model/your_model/`
   - `.model3.json` - 模型配置
   - `.moc3` - 模型二进制
   - `.physics3.json` - 物理配置
   - `.cdi3.json` - 显示信息
   - `texture_00.png` - 纹理
   - `motions/` - 动作文件

2. 修改 `web/js/app.js` 第 893 行：
```javascript
const modelUrl = new URL("./model/your_model/your_model.model3.json", window.location.href).toString();
```

#### Live2D SDK 说明
应用默认使用**占位动画**（圆形角色）。如需完整 Live2D 动画：
1. 从 [Live2D 官网](https://www.live2d.com/en/download/cubism-sdk/) 下载 Cubism SDK for Web
2. 将 `Core/live2dcubismcore.js` 复制到 `web/js/`
3. 将 `Framework/` 中的库文件复制到 `web/js/`
4. 重启应用

---

## 📊 数据存储

### 统计数据 (`data/stats.json`)
```json
{
  "2026-01-15": { "focus_seconds": 3600 },
  "2026-01-16": { "focus_seconds": 7200 }
}
```

### 配置文件 (`data/settings.json`)
```json
{
  "settings": {
    "focus_active_ms": 60000,
    "focus_sleep_ms": 120000,
    "window_opacity": 100,
    "model_scale": 0.35,
    "model_path": "model/miku/miku.model3.json",
    "bindings_path": "data/model_bindings.json",
    "ui_scale": 1.0,
    "animation_speed": 1.0,
    "pomodoro_focus_min": 25,
    "pomodoro_break_min": 5,
    "rest_enabled": true,
    "rest_interval_min": 90,
    "water_enabled": true,
    "water_interval_min": 60,
    "eye_enabled": true,
    "eye_interval_min": 45,
    "ai_providers": [...],
    "passive_enabled": true,
    "passive_interval_min": 30,
    "passive_random_enabled": true,
    "passive_blessing_enabled": true,
    "passive_focus_enabled": true,
    "passive_focus_interval_min": 60,
    "last_login_date": "2026-01-15",
    "login_streak": 1,
    "favor": 50,
    "mood": 60,
    "hotkey_toggle_pet": "Ctrl+Shift+L",
    "hotkey_note": "Ctrl+Shift+P",
    "hotkey_pomodoro": "Ctrl+Shift+T",
    "hotkey_launcher_panel": "Ctrl+Shift+Space"
  }
}
```

**新增字段说明：**
- `model_path` - 当前模型路径
- `bindings_path` - 动作绑定配置路径
- `last_login_date` - 上次登录日期，用于计算连续天数
- `login_streak` - 连续登录天数
- `favor` - 好感度（0-100），影响对话语气
- `mood` - 心情值（0-100），影响语气与被动频率
- `hotkey_*` - 自定义全局热键配置

### 剪贴板历史 (`data/clipboard.json`)
```json
[
  { "text": "复制的内容", "time": "2026-01-16T10:30:00" },
  { "text": "另一段内容", "time": "2026-01-16T10:31:00" }
]
```

### 待办事项 (`data/reminders.json`)
```json
{
  "todos": [
    {
      "id": 1,
      "title": "完成报告",
      "due_ts": 1736941200,
      "triggered": false
    }
  ]
}
```

### 快速启动器 (`data/launchers.json`)
```json
{
  "launchers": [
    {
      "id": 1,
      "name": "GitHub",
      "type": "web",
      "url": "https://github.com",
      "icon": "🐙",
      "tags": ["开发", "代码"],
      "hotkey": "Ctrl+Shift+G",
      "usage_count": 42
    },
    {
      "id": 2,
      "name": "VS Code",
      "type": "app",
      "path": "C:\\Program Files\\Microsoft VS Code\\Code.exe",
      "args": ["--folder-uri", "d:/projects"],
      "icon": "💻",
      "tags": ["开发", "编辑器"],
      "hotkey": "Ctrl+Shift+V",
      "usage_count": 128
    }
  ],
  "recent": [2, 1]
}
```

### 插件配置 (`data/settings.json`)
插件的启用/禁用状态存储在 `settings.json` 的 `plugins_enabled` 字段中：
```json
{
  "settings": {
    "plugins_enabled": {
      "demo_plugin": true,
      "another_plugin": false
    }
  }
}
```

### 插件数据目录 (`data/plugins/`)
每个插件有独立的数据目录：
```
data/plugins/
├── demo_plugin/
│   └── calls.json  # 插件自定义数据
└── another_plugin/
    └── ...         # 其他插件数据
```

---

## ⚠️ 安全注意事项

### 快速启动器安全
快速启动器支持执行本地应用程序，使用时请注意：

1. **路径验证**
   - 避免使用用户输入的路径作为启动参数
   - 建议使用绝对路径而非相对路径

2. **应用参数**
   - 谨慎使用命令行参数，避免代码注入风险
   - 建议仅使用静态参数，不要接受用户动态输入

3. **热键冲突**
   - 启动项自定义热键可能与系统快捷键冲突
   - 建议使用带 Ctrl/Shift/Alt 的组合键

### 数据文件安全
- `launchers.json` 包含应用程序路径和参数
- 建议从受信任来源导入启动配置
- 不要执行来源不明的启动项

### 更多安全信息
详见 [故障排除](#-故障排除) 章节中的详细说明。

---

## 🔍 故障排除

### 问题：宠物窗口不显示
**解决方案：**
1. 检查 PySide6 是否正确安装：`pip show PySide6`
2. 查看日志：`data/app.log`
3. 重启应用

### 问题：专注时间不记录
**解决方案：**
1. 确认未点击"暂停统计"
2. 检查设置中的阈值是否合理
3. 查看日志中的状态变化

### 问题：AI 聊天无响应
**解决方案：**
1. 检查 API Key 是否正确配置
2. 点击"测试连接"验证 API 可用性
3. 确认网络连接正常
4. 检查 Base URL 是否正确

### 问题：Live2D 模型未加载
**解决方案：**
1. 确认模型文件在 `web/model/miku/` 目录
2. 检查 `web/js/` 是否有 Live2D SDK 文件
3. 查看控制台错误（F12）
4. 默认会使用占位动画，不影响使用

### 问题：系统信息显示 "-"
**解决方案：**
1. 确认已安装 `psutil`：`pip show psutil`
2. 某些系统信息可能需要管理员权限
3. 电池信息仅在笔记本电脑上显示

### 问题：剪贴板历史为空
**解决方案：**
1. 复制一些文本（Ctrl+C）
2. 等待 1 秒自动捕获
3. 打开剪贴板面板查看

### 问题：热键不生效
**解决方案：**
1. 检查热键是否与其他程序冲突
2. 确认热键格式正确（如：Ctrl+Shift+L）
3. 查看日志中的热键注册信息
4. 重启应用重新注册热键

### 问题：快速启动器热键执行错误
**说明：** 启动项自定义热键可能存在闭包陷阱问题，所有热键可能执行同一个启动项。

**解决方案：**
1. 暂时使用搜索功能或点击方式启动
2. 等待后续版本修复

### 问题：快速启动器执行失败
**说明：** 应用程序路径或参数可能存在问题。

**解决方案：**
1. 检查路径是否正确（建议使用绝对路径）
2. 确认应用程序是否存在
3. 查看日志中的错误信息

---

## 🛠️ 开发指南

### 运行测试

```bash
# 运行单元测试
python -m unittest discover -s test -p "test_*.py"
```

### 插件开发

插件系统允许你扩展应用功能，无需修改核心代码。

#### 1. 创建插件

在 `plugins/` 目录下创建插件文件夹：

```
plugins/
└── my_plugin/
    ├── plugin.json      # 插件清单
    └── main.py          # 插件入口
```

#### 2. 插件清单 (`plugin.json`)

```json
{
  "id": "my_plugin",
  "name": "我的插件",
  "version": "1.0.0",
  "description": "这是一个示例插件",
  "entry": "main.py"
}
```

#### 3. 插件入口 (`main.py`)

```python
class Plugin:
    def __init__(self, context):
        self.context = context

    def on_load(self, context):
        """插件加载时调用"""
        pass

    def on_unload(self):
        """插件卸载时调用"""
        pass

    def on_app_start(self):
        """应用启动时调用"""
        pass

    def on_app_ready(self):
        """应用就绪时调用"""
        pass

    def on_settings(self, settings_dict):
        """设置更新时调用"""
        pass

    def on_state(self, state_dict):
        """状态变化时调用"""
        pass

    def on_tick(self, state_dict, now_ts):
        """每秒调用一次"""
        pass

    def on_user_message(self, text):
        """用户发送消息时调用"""
        pass

    def on_ai_reply(self, text):
        """AI回复时调用"""
        pass

    def on_passive_message(self, text):
        """被动消息时调用"""
        pass
```

#### 4. 插件上下文

插件可以通过 `context` 访问应用功能：

```python
def on_load(self, context):
    # 获取数据目录
    data_path = context.get_data_path("my_data.json")

    # 访问设置
    settings = context.settings.get_settings()

    # 访问桥接器
    context.bridge.push_passive_message("插件已加载！")
```

#### 5. 插件管理

- **安装插件**：右键托盘 → 插件管理 → 安装目录
- **导入插件**：右键托盘 → 插件管理 → 导入压缩包
- **启用/禁用**：在插件管理面板勾选/取消勾选
- **重载插件**：右键托盘 → 插件管理 → 重新加载选中/全部

### 添加新功能

#### 1. 后端模块
在 `backend/` 创建新模块，例如 `new_feature.py`：
```python
class NewFeature:
    def __init__(self):
        self.data = {}

    def process(self):
        # 实现功能
        pass
```

#### 2. 前端界面
在 `web/index.html` 添加 UI 元素：
```html
<div id="new-panel" class="tool-panel">
  <div class="panel-title">
    新功能
    <button class="panel-close" data-close="new-panel">×</button>
  </div>
  <!-- 内容 -->
</div>
```

在 `web/js/app.js` 添加逻辑：
```javascript
function setupNewPanel() {
  // 事件绑定
}
```

#### 3. 桥接通信
在 `backend/bridge.py` 添加方法：
```python
@Slot(result=dict)
def getNewData(self) -> dict:
    return self._new_feature.get_data()
```

### 日志查看

应用日志位于 `data/app.log`，包含：
- 应用启动/关闭
- 状态变化（活跃/空闲/睡眠）
- 设置更新
- AI 聊天记录
- 错误信息

---

## 📝 使用示例

### 场景1：专注工作追踪
1. 启动应用，宠物出现在右下角
2. 正常使用电脑工作
3. 宠物自动追踪你的专注时间
4. 每隔一段时间收到专注播报
5. 工作结束后，右键托盘图标查看今日专注时长

### 场景2：番茄钟工作法
1. 右键宠物 → 番茄钟
2. 设置专注 25 分钟，休息 5 分钟
3. 点击"开始"
4. 专注期间，宠物显示专注状态
5. 休息时间到，收到系统通知
6. 查看今日完成的番茄钟数量

### 场景3：健康提醒
1. 右键宠物 → 智能提醒
2. 启用：
   - 休息提醒：90分钟
   - 喝水提醒：60分钟
   - 护眼提醒：45分钟
3. 添加待办事项："18:00 健身"
4. 专注工作时，自动收到健康提醒
5. 到达任务时间，收到通知

### 场景4：AI 聊天助手
1. 配置 AI API（右键托盘 → AI 详细配置）
2. 展开聊天面板
3. 输入问题，如："我今天专注了多久？"
4. AI 会结合你的专注时间回答
5. 保存常用对话到便签

### 场景5：剪贴板管理
1. 正常复制文本（Ctrl+C）
2. 右键宠物 → 工具 → 剪贴板历史
3. 搜索历史记录
4. 点击某条记录，自动复制到剪贴板
5. 点击"清空记录"删除历史

### 场景6：快速启动器
1. 右键宠物 → 工具 → 快速启动
2. 点击"添加启动项"
3. 填写名称、类型、URL/路径
4. 为常用工具设置热键（如 Ctrl+Shift+G 打开 GitHub）
5. 按热键或搜索后一键打开

---

## 🎨 自定义技巧

### 窗口美化
- **透明度**：设置 80-90% 让宠物半透明
- **位置**：使用"窗口位置"菜单快速定位
- **锁定**：防止误触移动

### 模型调整
- **缩放**：0.3-0.5 适合桌面角落
- **微调**：使用设置中的偏移量微调位置
- **动画速度**：0.8-1.2 倍速更自然

### 通知优化
- **专注播报**：间隔 60-120 分钟
- **随机闲聊**：间隔 30-60 分钟
- **健康提醒**：根据工作习惯调整

### 快速启动器优化
- **标签分类**：为启动项添加标签（开发、办公、娱乐）
- **热键绑定**：为最常用的 3-5 个工具设置独立热键
- **启动套件**：将相关工具打包（如"前端开发"=VS Code+Chrome+终端）

---

## 🐛 已知问题

### 1. 备份功能不包含启动器配置
**问题描述：** 自动备份功能（右键托盘 → 数据备份）不包含 `launchers.json` 文件。

**影响范围：** 数据备份与恢复

**解决方案：**
- 手动导出启动器配置：工具面板 → 快速启动 → 导出
- 手动导入启动器配置：工具面板 → 快速启动 → 导入

### 2. 路径安全考虑
**问题描述：** 快速启动器的路径处理存在安全风险。

**影响范围：** 快速启动器的"应用"类型启动项

**安全建议：**
- 仅添加受信任的应用程序路径
- 避免使用用户输入的动态路径
- 建议使用绝对路径而非相对路径

---

## 📚 技术栈

### 后端
- **PySide6** - Qt for Python GUI 框架
- **PyQt WebEngine** - 嵌入式浏览器
- **requests** - HTTP 客户端
- **psutil** - 系统监控
- **ctypes** - Windows API 调用

### 前端
- **HTML5/CSS3** - 界面结构和样式
- **JavaScript ES6+** - 应用逻辑
- **PixiJS** - WebGL 渲染引擎
- **Live2D Cubism SDK** - 角色动画

### 通信
- **QWebChannel** - Python ↔ JavaScript 双向通信
- **WebSocket** - 底层传输

---

## 📄 许可证

本项目采用 [MIT 许可证](LICENSE)。

**注意：** Live2D Miku 模型受 Live2D 版权保护，请遵守其使用条款。

---

## 🙏 致谢

- [Live2D Cubism](https://www.live2d.com/) - 提供角色动画技术
- [PySide6](https://doc.qt.io/qtforpython/) - Python GUI 框架
- [PixiJS](https://pixijs.com/) - WebGL 渲染引擎
- [psutil](https://github.com/giampaolo/psutil/) - 系统监控库

---

## 🔄 更新日志

### v2.5.0 (2026-01-16) - 插件系统
**新增功能：**
- ✅ **插件系统** - 支持扩展插件的加载、启用/禁用、重载、安装/卸载
- ✅ **插件管理面板** - 前端插件管理界面，支持查看插件状态、测试钩子
- ✅ **插件钩子** - 支持 on_app_start、on_app_ready、on_settings、on_state、on_tick、on_user_message、on_ai_reply、on_passive_message 等钩子
- ✅ **插件安装/卸载** - 支持从目录安装、ZIP导入、导出、卸载插件
- ✅ **插件数据隔离** - 每个插件有独立的数据目录

### v2.4.0 (2026-01-16) - 快速启动器
**新增功能：**
- ✅ **快速启动器** - 一键打开网页/应用/工作流组合
- ✅ **启动项热键** - 为每个启动项绑定独立热键
- ✅ **启动套件** - 一键启动多个相关应用
- ✅ **最近使用** - 显示最近打开的 5 个启动项
- ✅ **搜索功能** - 实时搜索启动项（名称/标签）
- ✅ **导入/导出** - 支持启动器配置的导入导出

**已知问题：**
- ⚠️ 自动备份不包含 launchers.json，需手动导出

### v2.4.0 (2026-01-16) - ???????
**?????**
- ? **????** - ??????/?????????????
- ? **??????** - ????/??/??/????
- ? **????????** - ???????????????

### v2.3.0 (2026-01-16) - 动作绑定
**新增功能：**
- ✅ **动作绑定系统** - 可配置心情/状态/番茄钟/AI/互动与动作表情的绑定
- ✅ **模型切换** - 工具面板一键切换本地模型
- ✅ **预设管理** - 保存/应用/导出/导入动作绑定预设

### v2.2.0 (2026-01-16) - 连动增强
**新增功能：**
- ✅ **动作绑定系统** - 可配置心情/状态/番茄钟/AI/互动与动作表情的绑定
- ✅ **模型切换** - 工具面板一键切换本地模型

### v2.1.0 (2026-01-15) - 增强版
**新增功能：**
- ✅ **每日登录奖励** - 连续登录天数追踪与好感度奖励系统
- ✅ **数据备份与恢复** - 一键 ZIP 备份/恢复所有数据，自动重启生效
- ✅ **快速工具栏** - 悬浮4按钮工具栏，2.5秒自动隐藏
- ✅ **增强被动对话** - 30+随机消息，IDE/浏览器/设计/睡眠情境感知
- ✅ **番茄钟进度条** - 实时可视化进度显示
- ✅ **AI 对话历史** - 6轮上下文记忆，更连贯对话
- ✅ **交互式反馈** - 打字鼓励、空闲提醒、窗口切换建议
- ✅ **全局热键** - Ctrl+Shift+L/P/T 快速操作
- ✅ **好感度系统** - 互动影响语气（80+亲近，25-礼貌）
- ✅ **更多状态面板** - 详细系统信息展示
- ✅ **心情/状态系统** - 心情计算与对话语气/被动频率联动
- ✅ **每日/每周总结推送** - 17:00 或条件达成推送专注总结
- ✅ **热键可视化提示** - 按住 Ctrl+Shift 显示热键浮窗
- ✅ **托盘重启** - 一键重启应用

**后端改进：**
- `login_rewards.py` - 登录奖励模块
- `hotkeys.py` - 全局热键管理
- `ai_client.py` - 对话历史支持
- `bridge.py` - 备份/恢复信号扩展
- `main.py` - 登录奖励、备份恢复、热键、交互反馈
- `passive_chat.py` - 30+消息池，情境感知增强

**前端改进：**
- `app.js` - 快速工具栏、备份UI、进度条、更多状态面板、插件UI
- `index.html` - 完整UI面板支持（新增插件管理面板）

### v2.0.0 (2026-01-15)
**新增功能：**
- ✅ 番茄钟系统
- ✅ 智能提醒（休息/喝水/护眼）
- ✅ 待办事项管理
- ✅ 被动对话引擎
- ✅ 剪贴板历史
- ✅ 便签/备忘录
- ✅ 系统信息监控
- ✅ 多 AI 提供商支持
- ✅ 完整的设置界面
- ✅ 前端工具面板

**改进：**
- 🎨 全新 UI 设计
- ⚡ 实时数据同步
- 🔒 配置持久化
- 📊 统计数据可视化

### v1.0.0 (初始版本)
- Live2D 宠物显示
- 专注时间追踪
- AI 聊天集成
- 基础系统托盘

---

## 🤝 贡献指南

欢迎贡献代码或建议！

### 提交功能建议
在 GitHub Issues 中描述：
- 功能名称和描述
- 使用场景和价值
- 预期的实现方式

### 开发新功能
1. Fork 项目
2. 创建功能分支 `feature/your-feature`
3. 提交 Pull Request
4. 等待审核合并

---

**祝你使用愉快！** 🎉

让这个小宠物陪伴你的每一个专注时刻～
