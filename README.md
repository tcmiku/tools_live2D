# DeskPet Live2D - 智能桌面宠物助手

> 一个集成了 Live2D 动画角色、专注时间追踪、番茄钟、AI 聊天和实用工具的桌面宠物应用

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)
[![PySide6](https://img.shields.io/badge/PySide6-6.5%2B-green)](https://pypi.org/project/PySide6/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

---

## ✨ 功能特性

### 🎯 核心功能
- **Live2D 动画角色** - 桌面端实时渲染的可爱角色（支持占位动画）
- **专注时间追踪** - 自动检测用户活动状态，记录每日专注时长
- **智能状态检测** - 活跃/空闲/睡眠三种状态，实时反馈
- **交互式反馈** - 根据用户行为触发宠物对话和动作

### 🔥 新增亮点功能
- **成就徽章系统** - 解锁专注里程碑，获得可视化成就奖励
- **智能情景模式** - 按时间自动切换专注阈值（工作/创作/会议模式）
- **番茄钟联动** - 专注期间自动调整检测灵敏度，完成获得好感度奖励
- **情境感知对话** - 根据当前窗口（IDE/浏览器/设计软件）智能聊天
- **键盘快捷键** - 全局热键快速操作（显示/隐藏、便签、番茄钟）

### 🤖 AI 聊天系统
- **OpenAI 兼容 API** - 支持多种 AI 服务提供商
- **多提供商配置** - 可配置多个 AI 提供商并启用/禁用
- **上下文感知** - 聊天时自动附带今日专注时间作为上下文
- **好感度系统** - 互动影响宠物语气，80+ 亲近，25- 保持礼貌
- **连接测试** - 内置 API 连接测试工具

### 🍅 番茄钟工作法
- **专注/休息循环** - 25分钟专注 + 5分钟休息（可自定义）
- **每日统计** - 记录完成的番茄钟数量
- **实时倒计时** - 显示剩余时间
- **自动通知** - 模式切换时系统托盘提醒
- **专注奖励** - 完成番茄钟获得好感度

### 🧠 智能提醒系统
- **休息提醒** - 长时间专注后提醒休息（默认90分钟）
- **喝水提醒** - 定时提醒补充水分（默认60分钟）
- **护眼提醒** - 定时提醒远眺放松（默认45分钟）
- **待办事项** - 支持设置带时间的任务提醒
- **智能触发** - 仅在活跃状态计时，避免无效提醒

### 💬 被动对话
- **自动问候** - 早安（5-10点）/晚安（20-23点）
- **专注播报** - 定期汇报专注进度（默认60分钟）
- **随机闲聊** - 间隔性发送鼓励消息（默认30分钟）
- **情境感知** - 根据当前窗口智能对话（IDE/浏览器/设计软件）
- **健康提醒** - 健康相关的温馨提示

### 🔧 实用工具
- **便签/备忘录** - 快速记录，自动保存，300ms 防抖
- **剪贴板历史** - 自动记录复制历史（最多30条），支持搜索和恢复
- **系统监控** - CPU、内存、网络、电池实时监控（1秒刷新）
- **全局热键** - Ctrl+Shift+L/P/T 快速操作

### 🎨 个性化设置
- **窗口设置** - 透明度、位置、锁定、显示/隐藏
- **模型调整** - 缩放、位置微调、动画速度
- **UI 缩放** - 界面大小调整（0.5-2.0倍）
- **专注阈值** - 自定义活跃/睡眠判定时间
- **热键配置** - 可自定义全局快捷键

---

## 📁 项目结构

```
tools_live2D/
├── backend/                    # Python 后端
│   ├── main.py                # 应用入口，GUI 和系统托盘
│   ├── bridge.py              # 后端-前端通信桥
│   ├── ai_client.py           # AI API 集成
│   ├── focus.py               # 专注/空闲检测引擎
│   ├── stats.py               # 专注统计管理
│   ├── settings.py            # 配置管理
│   ├── pomodoro.py            # 番茄钟引擎
│   ├── reminders.py           # 提醒系统
│   ├── passive_chat.py        # 被动对话引擎
│   ├── clipboard.py           # 剪贴板历史
│   ├── notes.py               # 便签存储
│   └── sysinfo.py             # 系统信息监控
├── web/                        # 前端界面
│   ├── index.html             # 主界面
│   └── js/
│       ├── app.js             # 前端逻辑
│       ├── live2d.core.min.js # Live2D Core (需手动添加)
│       ├── live2d.min.js      # Live2D 库 (需手动添加)
│       └── pixi.min.js        # PixiJS 渲染引擎
├── web/model/miku/             # Live2D 模型文件
├── assets/                     # 应用资源
│   └── tray_icon.png          # 托盘图标
├── data/                       # 运行时数据 (自动生成)
│   ├── settings.json          # 配置文件
│   ├── stats.json             # 专注统计数据
│   ├── pomodoro.json          # 番茄钟统计
│   ├── reminders.json         # 待办事项
│   ├── clipboard.json         # 剪贴板历史
│   ├── note.txt               # 便签内容
│   └── app.log                # 应用日志
├── miku/                       # Live2D Miku 模型源文件
├── test/                       # 单元测试
├── requirements.txt            # Python 依赖
└── README.md                   # 本文档
```

---

## 🚀 快速开始

### 1. 环境要求
- **Python** 3.8 或更高版本
- **Windows** 10/11 (专注检测依赖 Windows API)
- **内存** 至少 2GB 可用

### 2. 安装依赖

```bash
# 安装 Python 依赖
pip install -r requirements.txt
```

**requirements.txt 内容:**
```
PySide6[webengine]  # Qt GUI 框架 + Web 引擎
requests            # HTTP 客户端
psutil              # 系统监控
```

### 3. 运行应用

```bash
# 启动应用
python backend/main.py
```

应用启动后：
1. 会在右下角显示 Live2D 宠物窗口
2. 系统托盘出现图标
3. 开始自动追踪用户活动

---

## 🎮 使用指南

### 系统托盘菜单

右键点击托盘图标访问所有功能：

| 菜单项 | 功能 |
|--------|------|
| **暂停统计** | 暂停专注时间追踪 |
| **查看今日专注时间** | 显示今日专注时长 |
| **个性化设置** | 调整窗口和模型参数 |
| **AI 详细配置** | 配置多个 AI 提供商 |
| **窗口位置** | 快速定位到屏幕角落 |
| **隐藏宠物窗口** | 显示/隐藏宠物 |
| **锁定位置** | 禁止拖动宠物窗口 |
| **关闭程序** | 退出应用 |

### 前端界面操作

#### 1. 聊天面板（左下角）
- **点击标题** - 展开/收起聊天框
- **移动按钮** - 进入移动模式，可拖动整个窗口
- **设置按钮** - 打开快速设置面板
- **输入框** - 与 AI 对话（需配置 API Key）

#### 2. 右键菜单（宠物窗口）
在宠物窗口任意位置右键，弹出功能菜单：
- 工具 - 打开工具面板
- 番茄钟 - 开启番茄钟模式
- 智能提醒 - 配置健康提醒
- AI 配置 - 设置 AI 参数
- 被动对话 - 配置自动对话
- 设置 - 个性化调整
- 隐藏聊天框 - 切换聊天框显示

#### 3. 工具面板
点击右键菜单的"工具"，可访问：
- **便签/备忘录** - 快速笔记，自动保存
- **剪贴板历史** - 查看和恢复复制记录
- **系统信息** - 实时监控电脑状态

#### 4. 番茄钟面板
- 设置专注/休息时长
- 开始/暂停/停止计时
- 查看今日完成数量

#### 5. 智能提醒面板
- 启用/禁用各类提醒
- 调整提醒间隔（分钟）
- 打开待办事项列表

#### 6. 待办事项
- 输入任务标题和截止时间
- 点击"添加"创建任务
- 到达时间后系统托盘提醒
- 可删除已完成的任务

#### 7. AI 配置面板
- **提供商名称** - 自定义名称（如：OpenAI、Claude 等）
- **Base URL** - API 地址
- **模型名称** - 使用的模型
- **API Key** - 密钥（密码形式显示）
- **保存** - 保存配置
- **详细配置** - 多提供商管理
- **测试连接** - 验证 API 可用性

#### 8. 被动对话配置
- **启用** - 总开关
- **随机闲聊** - 每30分钟随机消息
- **早晚祝福** - 5-10点早安，20-23点晚安
- **专注播报** - 每60分钟汇报专注进度

#### 9. 个性化设置（快速设置）
- **活跃阈值** - 判定活跃的空闲秒数（默认60秒）
- **睡眠阈值** - 判定睡眠的空闲秒数（默认120秒）
- **透明度** - 窗口透明度（0-100%）
- **模型缩放** - Live2D 模型大小
- **界面缩放** - UI 元素大小
- **动画速度** - 角色动画速度

---

## 🔧 高级配置

### AI 提供商配置

#### 方法1：快速配置（前端）
1. 右键宠物 → AI 配置
2. 填写 Base URL、模型、API Key
3. 点击保存

#### 方法2：详细配置（多提供商）
1. 右键托盘图标 → AI 详细配置
2. 点击"新增"添加多个提供商
3. 勾选"启用"决定使用哪个
4. 支持优先级（第一个为默认）

#### 支持的 API 格式
```json
{
  "name": "OpenAI兼容",
  "base_url": "https://api.openai.com/v1",
  "model": "gpt-4o-mini",
  "api_key": "sk-...",
  "enabled": true
}
```

#### 常用提供商示例
| 服务商 | Base URL | 模型 |
|--------|----------|------|
| OpenAI | `https://api.openai.com/v1` | `gpt-4o-mini` |
| Azure OpenAI | `https://your-resource.openai.azure.com/openai/deployments/gpt-4o` | `gpt-4o` |
| 自建 API | `https://your-api.com/v1` | 自定义 |

### 环境变量配置

你也可以通过环境变量设置默认 AI 配置：

```bash
# Windows (CMD)
set OPENAI_API_KEY=sk-...
set OPENAI_BASE_URL=https://api.openai.com/v1
set OPENAI_MODEL=gpt-4o-mini

# Windows (PowerShell)
$env:OPENAI_API_KEY="sk-..."
$env:OPENAI_BASE_URL="https://api.openai.com/v1"
$env:OPENAI_MODEL="gpt-4o-mini"
```

### Live2D 模型配置

#### 默认模型
应用内置了 **Miku** 示例模型，位于：
- 源文件：`miku/miku/`
- 运行时：`web/model/miku/`

#### 使用自定义模型
1. 将 Live2D Cubism 5 导出的文件放入 `web/model/your_model/`
   - `.model3.json` - 模型配置
   - `.moc3` - 模型二进制
   - `.physics3.json` - 物理配置
   - `.cdi3.json` - 显示信息
   - `texture_00.png` - 纹理
   - `motions/` - 动作文件

2. 修改 `web/js/app.js` 第 893 行：
```javascript
const modelUrl = new URL("./model/your_model/your_model.model3.json", window.location.href).toString();
```

#### Live2D SDK 说明
应用默认使用**占位动画**（圆形角色）。如需完整 Live2D 动画：
1. 从 [Live2D 官网](https://www.live2d.com/en/download/cubism-sdk/) 下载 Cubism SDK for Web
2. 将 `Core/live2dcubismcore.js` 复制到 `web/js/`
3. 将 `Framework/` 中的库文件复制到 `web/js/`
4. 重启应用

---

## 📊 数据存储

### 统计数据 (`data/stats.json`)
```json
{
  "2026-01-15": { "focus_seconds": 3600 },
  "2026-01-16": { "focus_seconds": 7200 }
}
```

### 配置文件 (`data/settings.json`)
```json
{
  "settings": {
    "focus_active_ms": 60000,
    "focus_sleep_ms": 120000,
    "window_opacity": 100,
    "model_scale": 0.35,
    "ui_scale": 1.0,
    "animation_speed": 1.0,
    "pomodoro_focus_min": 25,
    "pomodoro_break_min": 5,
    "rest_enabled": true,
    "rest_interval_min": 90,
    "water_enabled": true,
    "water_interval_min": 60,
    "eye_enabled": true,
    "eye_interval_min": 45,
    "ai_providers": [...],
    "passive_enabled": true,
    "passive_interval_min": 30,
    "passive_random_enabled": true,
    "passive_blessing_enabled": true,
    "passive_focus_enabled": true,
    "passive_focus_interval_min": 60
  }
}
```

### 剪贴板历史 (`data/clipboard.json`)
```json
[
  { "text": "复制的内容", "timestamp": 1736937600 },
  { "text": "另一段内容", "timestamp": 1736937660 }
]
```

### 待办事项 (`data/reminders.json`)
```json
{
  "todos": [
    {
      "id": 1,
      "title": "完成报告",
      "due_ts": 1736941200,
      "triggered": false
    }
  ]
}
```

---

## 🔍 故障排除

### 问题：宠物窗口不显示
**解决方案：**
1. 检查 PySide6 是否正确安装：`pip show PySide6`
2. 查看日志：`data/app.log`
3. 重启应用

### 问题：专注时间不记录
**解决方案：**
1. 确认未点击"暂停统计"
2. 检查设置中的阈值是否合理
3. 查看日志中的状态变化

### 问题：AI 聊天无响应
**解决方案：**
1. 检查 API Key 是否正确配置
2. 点击"测试连接"验证 API 可用性
3. 确认网络连接正常
4. 检查 Base URL 是否正确

### 问题：Live2D 模型未加载
**解决方案：**
1. 确认模型文件在 `web/model/miku/` 目录
2. 检查 `web/js/` 是否有 Live2D SDK 文件
3. 查看控制台错误（F12）
4. 默认会使用占位动画，不影响使用

### 问题：系统信息显示 "-"
**解决方案：**
1. 确认已安装 `psutil`：`pip show psutil`
2. 某些系统信息可能需要管理员权限
3. 电池信息仅在笔记本电脑上显示

### 问题：剪贴板历史为空
**解决方案：**
1. 复制一些文本（Ctrl+C）
2. 等待 1 秒自动捕获
3. 打开剪贴板面板查看

---

## 🛠️ 开发指南

### 运行测试

```bash
# 运行单元测试
python -m pytest test/
```

### 添加新功能

#### 1. 后端模块
在 `backend/` 创建新模块，例如 `new_feature.py`：
```python
class NewFeature:
    def __init__(self):
        self.data = {}

    def process(self):
        # 实现功能
        pass
```

#### 2. 前端界面
在 `web/index.html` 添加 UI 元素：
```html
<div id="new-panel" class="tool-panel">
  <div class="panel-title">
    新功能
    <button class="panel-close" data-close="new-panel">×</button>
  </div>
  <!-- 内容 -->
</div>
```

在 `web/js/app.js` 添加逻辑：
```javascript
function setupNewPanel() {
  // 事件绑定
}
```

#### 3. 桥接通信
在 `backend/bridge.py` 添加方法：
```python
@Slot(result=dict)
def getNewData(self) -> dict:
    return self._new_feature.get_data()
```

### 日志查看

应用日志位于 `data/app.log`，包含：
- 应用启动/关闭
- 状态变化（活跃/空闲/睡眠）
- 设置更新
- AI 聊天记录
- 错误信息

---

## 📝 使用示例

### 场景1：专注工作追踪
1. 启动应用，宠物出现在右下角
2. 正常使用电脑工作
3. 宠物自动追踪你的专注时间
4. 每隔一段时间收到专注播报
5. 工作结束后，右键托盘图标查看今日专注时长

### 场景2：番茄钟工作法
1. 右键宠物 → 番茄钟
2. 设置专注 25 分钟，休息 5 分钟
3. 点击"开始"
4. 专注期间，宠物显示专注状态
5. 休息时间到，收到系统通知
6. 查看今日完成的番茄钟数量

### 场景3：健康提醒
1. 右键宠物 → 智能提醒
2. 启用：
   - 休息提醒：90分钟
   - 喝水提醒：60分钟
   - 护眼提醒：45分钟
3. 添加待办事项："18:00 健身"
4. 专注工作时，自动收到健康提醒
5. 到达任务时间，收到通知

### 场景4：AI 聊天助手
1. 配置 AI API（右键托盘 → AI 详细配置）
2. 展开聊天面板
3. 输入问题，如："我今天专注了多久？"
4. AI 会结合你的专注时间回答
5. 保存常用对话到便签

### 场景5：剪贴板管理
1. 正常复制文本（Ctrl+C）
2. 右键宠物 → 工具 → 剪贴板历史
3. 搜索历史记录
4. 点击某条记录，自动复制到剪贴板
5. 点击"清空记录"删除历史

---

## 🎨 自定义技巧

### 窗口美化
- **透明度**：设置 80-90% 让宠物半透明
- **位置**：使用"窗口位置"菜单快速定位
- **锁定**：防止误触移动

### 模型调整
- **缩放**：0.3-0.5 适合桌面角落
- **微调**：使用设置中的偏移量微调位置
- **动画速度**：0.8-1.2 倍速更自然

### 通知优化
- **专注播报**：间隔 60-120 分钟
- **随机闲聊**：间隔 30-60 分钟
- **健康提醒**：根据工作习惯调整

---

## 📚 技术栈

### 后端
- **PySide6** - Qt for Python GUI 框架
- **PyQt WebEngine** - 嵌入式浏览器
- **requests** - HTTP 客户端
- **psutil** - 系统监控
- **ctypes** - Windows API 调用

### 前端
- **HTML5/CSS3** - 界面结构和样式
- **JavaScript ES6+** - 应用逻辑
- **PixiJS** - WebGL 渲染引擎
- **Live2D Cubism SDK** - 角色动画

### 通信
- **QWebChannel** - Python ↔ JavaScript 双向通信
- **WebSocket** - 底层传输

---

## 📄 许可证

本项目采用 [MIT 许可证](LICENSE)。

**注意：** Live2D Miku 模型受 Live2D 版权保护，请遵守其使用条款。

---

## 🙏 致谢

- [Live2D Cubism](https://www.live2d.com/) - 提供角色动画技术
- [PySide6](https://doc.qt.io/qtforpython/) - Python GUI 框架
- [PixiJS](https://pixijs.com/) - WebGL 渲染引擎
- [psutil](https://github.com/giampaolo/psutil/) - 系统监控库

---

## 🔄 更新日志

### v2.0.0 (2026-01-15)
**新增功能：**
- ✅ 番茄钟系统
- ✅ 智能提醒（休息/喝水/护眼）
- ✅ 待办事项管理
- ✅ 被动对话引擎
- ✅ 剪贴板历史
- ✅ 便签/备忘录
- ✅ 系统信息监控
- ✅ 多 AI 提供商支持
- ✅ 完整的设置界面
- ✅ 前端工具面板

**改进：**
- 🎨 全新 UI 设计
- ⚡ 实时数据同步
- 🔒 配置持久化
- 📊 统计数据可视化

### v1.0.0 (初始版本)
- Live2D 宠物显示
- 专注时间追踪
- AI 聊天集成
- 基础系统托盘

---

## 🚀 推荐使用场景

### 场景 1：专注工作追踪
1. 启动应用，宠物出现在右下角
2. 正常使用电脑工作/编程
3. 宠物自动追踪专注时间，每小时播报进度
4. 工作结束后，右键托盘查看今日专注时长
5. **进阶**：配置成就系统，解锁专注里程碑

### 场景 2：番茄钟工作法
1. 右键宠物 → 番茄钟
2. 设置专注 25 分钟，休息 5 分钟
3. 点击"开始"，专注期间宠物显示专注状态
4. 休息时收到通知，完成获得好感度奖励
5. **技巧**：专注期间即使离开电脑也不会进入睡眠状态

### 场景 3：健康工作流
1. 启用智能提醒：
   - 休息提醒：90分钟
   - 喝水提醒：60分钟
   - 护眼提醒：45分钟
2. 添加待办事项："18:00 健身"
3. 专注工作时，自动收到健康提醒
4. **联动**：番茄钟完成时自动触发休息提醒

### 场景 4：情景模式自动切换
1. 配置情景模式：
   - 工作模式（9:00-12:00）：60秒判定
   - 创作模式（14:00-18:00）：45秒判定（更敏感）
   - 会议模式（15:00-16:00）：180秒判定（更宽松）
2. 应用会根据时间自动切换阈值
3. **优势**：无需手动调整，适应不同工作场景

### 场景 5：AI 助手 + 剪贴板管理
1. 配置 AI API，展开聊天面板
2. 复制代码/链接时，自动记录到剪贴板历史
3. 询问 AI："帮我解释这段代码"（附带上下文）
4. 使用热键 Ctrl+Shift+P 快速打开便签记录
5. **效率**：所有工具通过右键菜单或热键快速访问

---

## 💡 功能扩展建议

### 短期可实现（1-3小时）
1. **成就徽章系统**
   - 解锁条件：专注1小时、5小时、番茄钟10个等
   - UI：成就墙 + 解锁通知 + 桌宠庆祝

2. **智能情景模式**
   - 按时间自动切换专注阈值
   - 支持工作/创作/会议/自定义模式

3. **番茄钟深度联动**
   - 专注期间双倍计算专注时间
   - 完成时显示实际专注时长 vs 计划时长

### 中期规划（3-8小时）
4. **数据导出与可视化**
   - CSV/JSON 导出
   - 7/30 天趋势图表
   - 每日/每周/每月统计

5. **剪贴板智能增强**
   - 自动识别链接/代码/联系方式
   - 右键快速操作（打开/格式化/保存）

6. **成就通知特效**
   - 全屏弹窗 + 桌宠庆祝动作
   - 气泡显示解锁信息

### 长期愿景
7. **语音播报**
   - TTS 语音提醒
   - 多角色语音选择

8. **环境感知**
   - CPU 高负载时延迟提醒
   - 全屏应用时静音通知
   - 电池低电量时禁用语音

9. **键盘鼠标事件分析**
   - 打字时显示加油动画
   - 频繁切换窗口时提醒专注
   - 浏览器活跃时询问是否需要帮助

---

## 🤝 贡献指南

欢迎贡献代码或建议！

### 提交功能建议
在 GitHub Issues 中描述：
- 功能名称和描述
- 使用场景和价值
- 预期的实现方式

### 开发新功能
1. Fork 项目
2. 创建功能分支 `feature/your-feature`
3. 提交 Pull Request
4. 等待审核合并

---

**祝你使用愉快！** 🎉

让这个小宠物陪伴你的每一个专注时刻～

